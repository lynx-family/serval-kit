#!/bin/bash

# Copyright (c) 2023 Huawei Device Co., Ltd.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

set -e

# DevEco Studio paths
DEVECO_NODE="/Applications/DevEco-Studio.app/Contents/tools/node/bin/node"
DEVECO_HVIGOR="/Applications/DevEco-Studio.app/Contents/tools/hvigor/bin/hvigorw.js"

# Set SDK Home if not set
if [ -z "${DEVECO_SDK_HOME}" ]; then
    export DEVECO_SDK_HOME="/Applications/DevEco-Studio.app/Contents/sdk"
fi

HVIGOR_APP_HOME=$(cd "$(dirname "$0")"; pwd)
HVIGOR_WRAPPER_SCRIPT="${HVIGOR_APP_HOME}/oh_modules/@ohos/hvigor/bin/hvigor.js"

# Try DevEco Studio's hvigor first
if [ -f "${DEVECO_NODE}" ] && [ -f "${DEVECO_HVIGOR}" ]; then
    "${DEVECO_NODE}" "${DEVECO_HVIGOR}" "$@"
# Fall back to local oh_modules
elif [ -f "${HVIGOR_WRAPPER_SCRIPT}" ]; then
    node "${HVIGOR_WRAPPER_SCRIPT}" "$@"
else
    echo "ERROR: Neither DevEco Studio hvigor nor oh_modules/@ohos/hvigor found"
    echo "Please install DevEco Studio or execute 'npm install' / 'ohpm install'"
    exit 1
fi
